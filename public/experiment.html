<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>AAMU Experiment</title>
    
    <link rel="stylesheet" href="stylesheets/page.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="stylesheets/smenu.css" type="text/css" media="screen" title="no title" charset="utf-8">
    
    <style type="text/css" media="screen">
      .marker {
        background-color: #36B700 !important;
        background-image:none !important;
      }
      
      .target {
        background-color:#BC2C2F !important;
        background-image:none !important;
      }
      
      #thanks {
        display:none;
      }
      
      #count {
        display:none;
      }
    </style>
    
    <script src="javascripts/jquery.js" type="text/javascript" charset="utf-8"></script>

<script src="javascripts/jquery.smenu.js" type="text/javascript" charset="utf-8"></script>


    <script type="text/javascript" charset="utf-8">
      
      function randomNumber(start, range) {
        return Math.floor(Math.random() * range) + start;
      }
      
      function random() {
        return randomNumber(5, 3)
      }
      
      function generateMenuDepth(depth, items) {
        
        if(depth == 0) {
          return
        }
        
        var selected_items = [];
        var have_picked_one = false;
        
        $(items).each(function() {
          if(Math.random() <= 0.5) {
            have_picked_one = true
            selected_items.push($(this))
          }
        })
        
        if(!have_picked_one) {
          var index = randomNumber(0, $(items).size())
          var item = $(items)[index]
          selected_items.push($(item))
        }
        
        for(var i in selected_items) {
          var menu = $('<ul class="smenu-menu"></ul>')
          var item = selected_items[i]
          var count = random();
          for(var j = 0; j < count; j++) {
            var li = $('<li><a>Item ' + (j + 1) + '</a></li>')
            $(li).appendTo(menu);
          }
          
          $(menu).insertAfter(item)
          generateMenuDepth(depth - 1, $(menu).children())
        }
      }
      
      function createMenu(depth) {
        var menu = $('<ul class="smenu-menu-bar"></ul>');
        
        var count = random();        
        
        for (var i = 0; i < count; i++) {
          var item = $('<li><a>Item ' + (i + 1) + '</a></li>')
          $(item).appendTo(menu);
        }
        
        $(".menu").html(menu)
        generateMenuDepth(depth, $(menu).children());
        createMenuPath($(menu))
      }
      
      function createMenuPath(menu) {
        
        var size = $(menu).children("ul").size();
        
        if(size == 0) {
          var size = $(menu).children("li").size();
          var index = randomNumber(0, size)
          var item = $(menu).children("li")[index]
          $(item).addClass("target")
          
        } else {
          var index = randomNumber(0, size)
          var menu = $(menu).children("ul")[index]
          $(menu).prev("li").addClass("marker")
          createMenuPath($(menu))
        }
      }
      
      var records = []
      var experiment_running = false
      var time_start = null
      var time_end = null
      
      var aamu_trials = [false, true]
      var aamu_trials_index = 0
      
      var depth_trials = [2, 3, 4]
      var depth_trials_index = 0
      
      var trials = [0,1,2,3,4,5,6,7,8,9]
      var trials_index = -1
      
      var global_count = 60;
      var global_index = 0;
      
      function step() {
        trials_index++;
        if(trials_index >= trials.length) {
          trials_index = 0;
          depth_trials_index++;
          if(depth_trials_index >= depth_trials.length) {
            depth_trials_index = 0;
            aamu_trials_index++;
            if(aamu_trials_index >= aamu_trials.length) {
              $(".menu .smenu-menu-bar").remove();
              $("#count").hide();
              $("#thanks").show();
              return
            }
          }
        }
        
        global_index++
        $("#count #index").html(global_index)
        
        var aamu = aamu_trials[aamu_trials_index]
        var depth = depth_trials[depth_trials_index]
        createMenu(depth);
        $(".menu .smenu-menu-bar").smenu({
          aamu: aamu
        });
        
      }
      
      $(function() {
        
        $(".target").live('click', function() {
          if(experiment_running) {
            
            time_end = (new Date()).getTime()
            var duration = time_end - time_start
            
            var record = {
              duration: duration,
              aamu: aamu_trials[aamu_trials_index],
              depth: depth_trials[depth_trials_index],
              trial: trials_index
            }
            
            records.push(record)
            console.log(records);
            
            step();
          } else {
            createMenu(3);
            $(".menu .smenu-menu-bar").smenu();
          }
        });
        
        $(".smenu-menu-bar > li").live('click', function() {
          time_start = (new Date()).getTime()
        });
        
        
        $("#start").click(function() {
          experiment_running = true
          $("#start").hide()
          $("#count").show()
          step()
        });
        
        createMenu(3);
        $(".menu .smenu-menu-bar").smenu();
      })
    </script>
  </head>
  <body>
    
    
    <div id="page">
      <div id="header">
        <h1>AAMU - Experiment</h1>
      </div>
      <div id="content">
        
        <h2>Instructions</h2>
        
        <p>You will be given a series of menu navigation tasks. During these tasks you will be asked to follow a trail of green menu items until you find a red menu item. When you find the red menu item, click on it.</p>
        
        <p>Try to complete each task as quickly and accurately as possible.</p>
        
        <p>You can practice using the interface below. These tasks will not be recorded. Once you are comfortable with the interface, click the "Begin Experiment" button to start.</p>
        
        <h2>
          Interface - <a href="#" class="link" id="start">Start Experiment</a>
          <span id="count">
            <span id="index">1</span>
            of
            <span id="max">60</span>
          </span>
        </h2>
        
        <div class="menu"></div>
        
        <p id="thanks">
          Thank you for your participation. Your results have been saved. You can safely close your browser window.
        </p>
        
      </div>
      <div id="footer">
        By: Salman Ahmad
      </div>
    </div>
  </body>
</html>